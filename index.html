<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BaiduTemplate模板引擎</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link href="./javascripts/rainbow-dev-custom/themes/sunburst.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>BaiduTemplate</h1>
        <p>最简单好用的JS模板引擎，JS语法学习无成本，调用也只是一个函数哦！</p>
      </header>

      <div id="banner">
        <span id="logo"></span>
        <div class="downloads">
          <span>欢迎使用</span>
          <ul>
            <li><a href="https://raw.github.com/wangxiao/BaiduTemplate/master/baiduTemplate.js" class="button">下载</a></li>
            <li><a target='_blank' href="https://github.com/wangxiao/BaiduTemplate" class="button">查看GitHub</a></li>
            <li><a target='_blank' href="./debug/" class="button">在线体验</a></li>
            <li><a target='_blank' href="http://weibo.com/baidujs" class="button">关注我们</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>百度JS模板引擎 baiduTemplate 1.0.6 版</h1>
<br>
<h2>A、baiduTemplate 简介</h2>
<h3>0、baiduTemplate希望创造一个用户觉得“简单好用”的JS模板引擎</h3>
<pre><code data-language="javascript">注：等不及可以直接点左侧导航中的”C、使用举例“，demo即刻试用。</code></pre>

<h3>1、应用场景：</h3>

<pre><code data-language="javascript">前端使用的模板系统  或  后端Javascript环境发布页面
</code></pre>

<h3>2、功能概述：</h3>

<pre><code data-language="javascript">提供一套模板语法，用户可以写一个模板区块，每次根据传入的数据，
生成对应数据产生的HTML片段，渲染不同的效果。
</code></pre>

<h3>3、特性：</h3>

<pre><code data-language="javascript">1、语法简单，学习成本极低，开发效率提升很大，性价比较高（使用Javascript原生语法）；
2、默认HTML转义（防XSS攻击），并且支持包括URL转义等多种转义；
3、变量未定义自动输出为空，防止页面错乱；
4、功能强大，如分隔符可自定等多种功能；
</code></pre>

<br>

<h2>B、使用举例</h2>

<pre><code data-language="javascript">//直接复制即可使用，记得要下载baiduTemplate.js
//index.html
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="utf-8"/&gt;
&lt;title&gt;test&lt;/title&gt;

&lt;!-- 引入baiduTemplate --&gt;
&lt;script type="text/javascript" src="./baiduTemplate.js"&gt;&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div id='result'&gt;&lt;/div&gt;

&lt;!-- 模板1开始，可以使用script（type设置为text/html）来存放模板片段，并且用id标示 --&gt;
&lt;script id="t:_1234-abcd-1" type="text/html"&gt;
&lt;div&gt;
    &lt;!-- 我是注释，语法均为Javascript原生语法，默认分割符为 &lt;% %&gt; ，也可以自定义，参见API部分 --&gt;
    &lt;!-- 输出变量语句，输出title --&gt;
    &lt;h1&gt;title:&lt;%=title%&gt;&lt;/h1&gt;
    &lt;!-- 判断语句if else--&gt;
    &lt;%if(list.length&gt;1) { %&gt;
        &lt;h2&gt;输出list，共有&lt;%=list.length%&gt;个元素&lt;/h2&gt;
        &lt;ul&gt;
            &lt;!-- 循环语句 for--&gt;
            &lt;%for(var i=0;i&lt;5;i++){%&gt;
                &lt;li&gt;&lt;%=list[i]%&gt;&lt;/li&gt;
            &lt;%}%&gt;
        &lt;/ul&gt;
    &lt;%}else{%&gt;
        &lt;h2&gt;没有list数据&lt;/h2&gt;   
    &lt;%}%&gt;
&lt;/div&gt;  
&lt;/script&gt;
&lt;!-- 模板1结束 --&gt;

&lt;!-- 使用模板 --&gt;
&lt;script type="text/javascript"&gt;
var data={
    "title":'欢迎使用baiduTemplate',
    "list":[
        'test1:默认支持HTML转义，如输出&lt;script&gt;，也可以关掉，语法&lt;:=value&gt; 详见API',
        'test2:',
        'test3:',
        'test4:list[5]未定义，模板系统会输出空'
    ]
};

//使用baidu.template命名空间
var bt=baidu.template;

//可以设置分隔符
//bt.LEFT_DELIMITER='&lt;!';
//bt.RIGHT_DELIMITER='!&gt;';

//可以设置输出变量是否自动HTML转义
//bt.ESCAPE = false;

//最简使用方法
var html=bt('t:_1234-abcd-1',data);

//渲染
document.getElementById('result').innerHTML=html;
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h2>C、基本用法</h2>

<h3>0、引入文件：</h3>

<h4>baiduTemplate使用仅需引入baiduTemplate.js文件，未压缩是考虑大家调错阅读等方便，上线前请自行压缩代码。</h4>

<pre><code data-language="javascript">&lt;script type="text/javascript" src="./baiduTemplate.js"&gt;&lt;/script&gt;
</code></pre>

<h4>如果在nodejs环境中使用，可以通过npm包管理安装</h4>

<pre><code data-language="javascript">//注意：名称全部小写
npm install baidutemplate</code></pre>

<h3>1、放置模板片段：</h3>

<h4>页面中，模板块可以放在 &lt;script&gt; 中，设置type属性为text/template或text/html，用id标识，如：</h4>

<pre><code data-language="javascript">&lt;script id='test1' type="text/template"&gt;
&lt;!-- 模板部分 --&gt;

&lt;!-- 模板结束 --&gt;   
&lt;/script&gt;
</code></pre>

<h4>或者存放在 &lt;textarea&gt; 中，一般情况设置其CSS样式display:none来隐藏掉textarea，同样用id标识，如：</h4>

<pre><code data-language="javascript">&lt;textarea id='test2' style='display:none;'&gt;
&lt;!-- 模板部分 --&gt;

&lt;!-- 模板结束 --&gt;   
&lt;/textarea&gt;
</code></pre>

<h4>模板也可以直接存储在一个变量中</h4>

<pre><code data-language="javascript">var tpl = "&lt;!-- 模板开始 --&gt; 模板内容 &lt;!-- 模板结束 --&gt;";
</code></pre>
<br>

<h3>2、调用引擎方式</h3>

<h4>（1）、数据结构是一个JSON，如：</h4>

<pre><code data-language="javascript">var data={
    title:'baiduTemplate',
    list:[
      'test data 1',
      'test data 2',
      'test data3'
    ]
}
</code></pre>

<h4>（2）、baiduTemplate占用baidu.template命名空间</h4>

<pre><code data-language="javascript">//可以付值给一个短名变量使用
var bt = baidu.template;
</code></pre>

<h4>（3）、方法一：tpl是传入的模板(String类型)，可以是模板的id，可以是一个模板片段字符串，传入模板和对应数据返回对应的HTML片段</h4>

<pre><code data-language="javascript">//方法一：直接传入data，返回编译后的HTML片段
var html0 = baidu.template(tpl,data);  

//或直接传入id即可
var html0 = baidu.template('test1',data);  
</code></pre>

<h4>&nbsp;&nbsp;&nbsp;&nbsp;方法二：或者可以只传入tpl，这时返回的是一个编译后的函数，可以把这个函数缓存下来，传入不同的data就可以生成不同的HTML片段</h4>

<pre><code data-language="javascript">//方法二：先不传入data，返回编译后的函数
var fun = baidu.template(tpl);
//或直接传入id即可
var fun = baidu.template('test1');

//之后通过改变数据，调用缓存下来的函数，产生不同的HTML片段
var html1 = fun(data1);
var html2 = fun(data2);
</code></pre>

<h4>（4）、最后将他们插入到一个容器中即可</h4>

<pre><code data-language="javascript">document.getElementById('result0').innerHTML=html0;
document.getElementById('result1').innerHTML=html1;
document.getElementById('result2').innerHTML=html2;
</code></pre>
<br>
<h3>3、模板基本语法（默认分隔符为&lt;% %&gt;，也可以自定义）</h3>

<h4>分隔符内语句为js语法，如：</h4>

<pre><code data-language="javascript">&lt;% var test = function(){
    //函数体
};
if(1){}else{};
function testFun(){
    return;
};
%&gt;
</code></pre>

<h4>假定事先设置数据为</h4>

<pre><code data-language="javascript">var data={
    title:'baiduTemplate',
    list:['test1&lt;script&gt;','test2','test3']
}
</code></pre>

<h4>注释</h4>

<pre><code data-language="javascript">&lt;!-- 模板中可以用HTML注释 --&gt;  或  &lt;%* 这是模板自带注释格式 *%&gt;

&lt;% //分隔符内支持JS注释  %&gt;
</code></pre>

<h4>输出一个变量</h4>

<pre><code data-language="javascript">//默认HTML转义，如果变量未定义输出为空
&lt;%=title%&gt;  

//不转义
&lt;%:=title%&gt; 或 &lt;%-title%&gt;

//URL转义，UI变量使用在模板链接地址URL的参数中时需要转义
&lt;%:u=title%&gt;

//UI变量使用在HTML页面标签onclick等事件函数参数中需要转义
//“&lt;”转成“&amp;lt;”、“&gt;”转成“&amp;gt;”、“&amp;”转成“&amp;amp;”、“'”转成“\&amp;#39;”
//“"”转成“\&amp;quot;”、“\”转成“\\”、“/”转成“\/”、\n转成“\n”、\r转成“\r”
&lt;%:v=title%&gt;

//HTML转义（默认自动）
&lt;%=title%&gt; 或 &lt;%:h=title%&gt;
</code></pre>

<h4>判断语句</h4>

<pre><code data-language="javascript">&lt;%if(list.length){%&gt;
    &lt;h2&gt;&lt;%=list.length%&gt;&lt;/h2&gt;
&lt;%}else{%&gt;
    &lt;h2&gt;list长度为0&lt;h2&gt;
&lt;%}%&gt;
</code></pre>

<h4>循环语句</h4>

<pre><code data-language="javascript">&lt;%for(var i=0;i&lt;list.length;i++){%&gt;
        &lt;li&gt;&lt;%=list[i]%&gt;&lt;/li&gt;
&lt;%}%&gt;
</code></pre>

<h3>4、不推荐使用功能</h3>

<h4>用户可以自定义分隔符，默认为 &lt;% %&gt;，如：</h4>

<pre><code data-language="javascript">//设置左分隔符为 &lt;!
baidu.template.LEFT_DELIMITER='&lt;!';

//设置右分隔符为 &lt;!  
baidu.template.RIGHT_DELIMITER='!&gt;';
</code></pre>

<h4>自定义默认输出变量是否自动HTML转义</h4>

<pre><code data-language="javascript">//设置默认输出变量是否自动HTML转义，true自动转义，false不转义
baidu.template.ESCAPE = false;
</code></pre>

<h2>D、性能相关数据</h2>

<h4>前端模板引擎在传统桌面电脑的浏览器端编译模板并渲染页面，无较大的性能开销。但在移动端上面，性能数据较为重要，故发布移动端性能数据列表，希望能够给各位开发者提供一个参考。</h4>

<img style="border:1px solid #666;" src="./images/mobi-performance.png" />
<br>
<br>
<h4>总结：编译执行时间（前端模版编译以及json被转换为html字符串的时间）范围约在10~90毫秒，大部分集中在20~60毫秒之间。Dom渲染时间（html字符串通过dom.innerHTML被插入到div里的时间）范围约在40~160毫秒，大部分集中在50~130毫秒之间。测试页面（50条数据记录）：http://tieba.baidu.com/tb/test/s.html（数据在页面多次刷新时会有一些小范围浮动，只反映大致情况，2012-09-20 百度贴吧整理）

<h2 style="color:#800;">E、特别鸣谢</h2>
<h4 style="color:#800;">感谢各位业内的高手们对baiduTemplate的帮助！</h4>
<h4 style="color:#800;">感谢百度贴吧的大力支持，并且给出了移动端的测试数据，目前baiduTemplate使用在贴吧等百度移动端的产品上面，特别感谢这些产品的工程师们，也感谢各位业内使用者们！</h4>
<h4 style="color:#800;">感谢 @灰大、感谢 @王集鵠、感谢 @黄志龙、感谢 @严孙荣、感谢 @berg、感谢 @黄方荣、感谢 @rayi-、感谢 @东杰、感谢 @杨尊程、感谢 @冯威风、感谢 @糖饼、感谢 @风之石 、感谢 @貘大等等，感谢各位在使用的开发者们！</h4>

<h2>F、change log</h2>

<h3>1.0.6版本</h3>

<h4>重构代码，修正自定义变量加分号语法错误的bug</h4>

<h3>1.0.5版本</h3>

<h4>修改可能造成内存泄露的变量及方法直接挂在baidu.template命名空间下</h4>

<h3>1.0.4版本</h3>

<h4>经过第三方测试反馈，进行对编译后产生的函数性能优化，性能提高1/3以上</h4>

<h3>1.0.3版本</h3>

<h4>通过产品线反馈，经过讨论增加自定义是否默认转义接口 baidu.template.ESCAPE</h4>

<h3>1.0.2版本</h3>

<h4>优化正则，提升性能，修复bug，支持nodejs，支持npm install baidutemplate可以安装</h4>

<h3>1.0.1版本</h3>

<h4>优化正则，提升性能，修复bug</h4>


      </section>
      <footer>
        <p>Project maintained by <a href="http://weibo.com/crazycomputer">wangxiao</a></p>
      </footer>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
<!-- 代码高亮 -->    
<script src="./javascripts/rainbow-dev-custom/rainbow.min.js"></script>
<script src="./javascripts/rainbow-dev-custom/language/generic.js"></script>
<script src="./javascripts/rainbow-dev-custom/language/html.js"></script>
<script src="./javascripts/rainbow-dev-custom/language/javascript.js"></script>
<script src="./javascripts/rainbow-dev-custom/language/css.js"></script>
<!-- 代码高亮结束 -->    
  </body>
</html>